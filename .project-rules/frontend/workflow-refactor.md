---
description: Refactor 工作流程 - 代码重构和优化的标准流程
---

# 工作流程：Refactor（代码重构）

**原则：保持功能不变，提升代码质量，逐步重构。**

---

## 步骤 1：重构目标分析

1. **明确重构目标**
   - 为什么要重构？（如：代码重复、结构混乱、性能问题）
   - 重构的目标是什么？（如：提取组件、优化结构、提升可维护性）
   - 重构的范围是什么？（单个文件、单个模块、还是跨模块）

2. **代码分析**
   - 分析需要重构的代码结构
   - 识别重复代码和模式
   - 理解代码的依赖关系和使用场景
   - 评估重构的影响范围

3. **制定重构计划**
   - 列出重构的具体步骤
   - 确定重构的优先级
   - 识别重构的风险点
   - 确定验证方法

---

## 步骤 2：重构设计

**必须设计以下内容：**

### 2.1 目标结构设计
- 描述重构后的代码结构
- 列出需要提取的组件或函数
- 描述新的模块职责划分
- 描述新的依赖关系
- **重要：** 不需要创建统一的 `index.ts` 或 `index.tsx` 导出文件（如 `feature/example/index.ts`），直接使用具体文件的导入路径。注意：`page/` 目录下的 `index.tsx` 是页面入口文件，不是统一导出文件，这是允许的。

### 2.2 重构步骤设计
- 将重构拆分为多个小步骤
- 每个步骤应该是独立的、可验证的
- 确保每个步骤完成后代码仍然可以正常工作
- 确定每个步骤的验证方法

### 2.3 影响范围分析
- 列出所有需要修改的文件
- 列出所有受影响的依赖文件
- 评估重构对现有功能的影响
- 确定是否需要更新类型定义

**输出物：**
- 重构设计文档，包含目标结构和重构步骤
- 文件清单：列出所有需要创建、修改、删除的文件
- 步骤清单：列出所有重构步骤和验证方法

---

## 步骤 3：重构实施

**严格按照重构设计逐步实施：**

### 原则：
- 每次只完成一个小的重构步骤
- 每个步骤完成后立即验证
- 保持功能不变，只改变代码结构
- 遵循项目的代码规范和架构模式
- 不要一次性进行大规模重构
- 不要在重构时添加新功能

### 常见重构类型：

**3.1 提取组件**
- 识别重复的 UI 结构
- 创建新的组件文件
- 提取公共逻辑和 Props
- 更新所有使用位置
- 验证功能不变

**3.2 提取工具函数**
- 识别重复的业务逻辑
- 创建新的工具函数文件
- 提取公共逻辑
- 更新所有使用位置
- 验证功能不变

**3.3 重构 Manager 结构**
- 分析 Manager 的职责是否单一
- 拆分过大的 Manager
- 合并过小的 Manager
- 优化 Manager 之间的依赖关系
- 验证功能不变

**3.4 优化代码组织**
- 调整文件目录结构
- 移动文件到正确的位置
- 更新所有导入路径
- 验证功能不变
- **重要：** 不要创建统一的 `index.ts` 或 `index.tsx` 导出文件，直接使用具体文件的导入路径

---

## 步骤 4：增量验证

**每个重构步骤完成后：**
1. 运行类型检查确保没有类型错误
2. 运行代码格式检查确保格式正确
3. 运行代码质量检查确保符合规范
4. 读取并修复所有 lint 错误
5. 验证功能是否仍然正常工作（通过类型检查）

**重要：** 每个重构步骤都应该是独立的、可回滚的。如果某个步骤出现问题，应该立即回滚。

---

## 步骤 5：最终验证

- [ ] 所有重构步骤已完成
- [ ] 所有类型检查通过
- [ ] 所有 lint 检查通过
- [ ] 代码结构符合项目规范
- [ ] 没有引入新的技术债
- [ ] 代码可读性和可维护性提升
- [ ] 没有未使用的导入和代码
- [ ] 没有使用动态导入（`import()`、`require()`）
- [ ] 重构目标已达成

