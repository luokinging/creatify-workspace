---
description: å‰ç«¯å¼€å‘åæ¨¡å¼ - é¿å…æ»¥ç”¨ Hooks å’Œå¤æ‚ç»„ä»¶é€»è¾‘
---

# å‰ç«¯å¼€å‘åæ¨¡å¼ (Anti-Patterns)

ä¸ºäº†ä¿æŒä»£ç çš„å¯ç»´æŠ¤æ€§ã€æ€§èƒ½å’Œæ¸…æ™°åº¦ï¼Œä»¥ä¸‹æ˜¯åœ¨å‰ç«¯å¼€å‘ä¸­å¿…é¡»é¿å…çš„åæ¨¡å¼ã€‚

## 1. æ»¥ç”¨ React Hooks

### âŒ æ»¥ç”¨ `useMemo` å’Œ `useCallback`

**åæ¨¡å¼**ï¼šé»˜è®¤å°†æ‰€æœ‰å‡½æ•°å’Œå¯¹è±¡éƒ½åŒ…è£¹åœ¨ `useCallback` æˆ– `useMemo` ä¸­ã€‚
**åŸå› **ï¼š

- å¢åŠ äº†ä»£ç å¤æ‚åº¦ã€‚
- å¢åŠ äº†å†…å­˜å¼€é”€ã€‚
- åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œé‡æ–°åˆ›å»ºå‡½æ•°æˆ–å¯¹è±¡çš„å¼€é”€å¾®ä¹å…¶å¾®ï¼Œè¿œå°äº Hook æœ¬èº«çš„å¼€é”€ã€‚
  **æ­£ç¡®åšæ³•**ï¼š
- ä»…åœ¨ä»¥ä¸‹æƒ…å†µä½¿ç”¨ï¼š
  - ä½œä¸º `useEffect` çš„ä¾èµ–é¡¹ã€‚
  - ä¼ é€’ç»™ç»è¿‡ `React.memo` ä¼˜åŒ–çš„å­ç»„ä»¶ã€‚
  - è¿›è¡Œæå…¶æ˜‚è´µçš„è®¡ç®—ï¼ˆå¦‚å¤„ç†å¤§é‡æ•°æ®ï¼‰ã€‚

> **ğŸ”´ ç¡¬æ€§è§„å®š**ï¼šå¦‚æœ `useMemo`ã€`useCallback` æˆ– `useEffect` çš„ä»£ç å—è¶…è¿‡ **10 è¡Œ**ï¼Œå¿…é¡»å°†å…¶æå–åˆ° **ViewController** æˆ– **Manager** ä¸­ã€‚ç»„ä»¶å†…ä¸åº”åŒ…å«å¤æ‚çš„å†…è”é€»è¾‘ã€‚

### âŒ å¤æ‚çš„ `useEffect` é€»è¾‘

**åæ¨¡å¼**ï¼šåœ¨ `useEffect` ä¸­ç¼–å†™å¤æ‚çš„ä¸šåŠ¡é€»è¾‘ã€æ•°æ®è½¬æ¢æˆ–å¤šä¸ªä¸ç›¸å…³çš„å‰¯ä½œç”¨ã€‚
**åŸå› **ï¼š

- `useEffect` éš¾ä»¥æµ‹è¯•å’Œè°ƒè¯•ã€‚
- å®¹æ˜“å¯¼è‡´é—­åŒ…é™·é˜±å’Œæ— é™å¾ªç¯ã€‚
- é€»è¾‘åˆ†æ•£ï¼Œéš¾ä»¥è¿½è¸ªã€‚
  **æ­£ç¡®åšæ³•**ï¼š
- å°†ä¸šåŠ¡é€»è¾‘ç§»è‡³ **Manager**ã€‚
- `useEffect` ä»…ç”¨äºåŒæ­¥å¤–éƒ¨ç³»ç»Ÿï¼ˆå¦‚è®¢é˜…äº‹ä»¶ã€æ‰‹åŠ¨ DOM æ“ä½œï¼‰ã€‚
- æ•°æ®è·å–åº”ç”± Manager å¤„ç†ï¼Œç»„ä»¶åªè´Ÿè´£è®¢é˜…çŠ¶æ€ã€‚
- **éµå®ˆ 10 è¡Œé™åˆ¶**ï¼šå¦‚æœå‰¯ä½œç”¨é€»è¾‘è¶…è¿‡ 10 è¡Œï¼Œè¯·å°è£…æˆ ViewController æˆ–è€… Manager çš„æ–¹æ³•ã€‚

## 2. å¤æ‚çš„ç»„ä»¶é€»è¾‘

### âŒ ç»„ä»¶å†…çš„"ä¸Šå¸é€»è¾‘"

**åæ¨¡å¼**ï¼šç»„ä»¶å†…éƒ¨åŒ…å«å¤§é‡ `useState`ã€æ•°æ®å¤„ç†ã€API è°ƒç”¨å’Œæ¡ä»¶åˆ¤æ–­ã€‚
**åŸå› **ï¼š

- è¿åäº† UI ä¸é€»è¾‘åˆ†ç¦»çš„åŸåˆ™ã€‚
- ç»„ä»¶å˜å¾—éš¾ä»¥é˜…è¯»å’Œç»´æŠ¤ã€‚
- éš¾ä»¥å¤ç”¨é€»è¾‘ã€‚
  **æ­£ç¡®åšæ³•**ï¼š
- éµå¾ª **Manager æ¨¡å¼**ã€‚
- ç»„ä»¶åº”å½“æ˜¯"å“‘"çš„ï¼ˆDumb Componentï¼‰ï¼Œåªè´Ÿè´£æ¥æ”¶æ•°æ®å’Œæ¸²æŸ“ UIã€‚
- æ‰€æœ‰çš„çŠ¶æ€ç®¡ç†ã€API äº¤äº’å’Œä¸šåŠ¡è§„åˆ™éƒ½åº”å°è£…åœ¨ `*.manager.ts` ä¸­ã€‚

### âŒ åœ¨ç»„ä»¶ä¸­ç›´æ¥è°ƒç”¨ API

**åæ¨¡å¼**ï¼šåœ¨äº‹ä»¶å¤„ç†å‡½æ•°ä¸­ç›´æ¥è°ƒç”¨ `fetch` æˆ– API æœåŠ¡ã€‚

```typescript
// âŒ é”™è¯¯ç¤ºèŒƒ
const handleClick = async () => {
  const res = await api.post('/data', { ... });
  setData(res.data);
};
```

**æ­£ç¡®åšæ³•**ï¼š

- å§”æ‰˜ç»™ Manager å¤„ç†ã€‚

```typescript
// âœ… æ­£ç¡®ç¤ºèŒƒ
const handleClick = () => {
  manager.submitData();
};
```

## 3. çŠ¶æ€ç®¡ç†åæ¨¡å¼

### âŒ åœ¨ Store ä¸­å®šä¹‰ Actions

**åæ¨¡å¼**ï¼šåœ¨ `createStore` æˆ– `combine` ä¸­å®šä¹‰ä¿®æ”¹çŠ¶æ€çš„æ–¹æ³•ï¼ˆActionsï¼‰ã€‚

```typescript
// âŒ é”™è¯¯ç¤ºèŒƒ
private readonly store = create(
  combine(initialState, (set) => ({
    updateName: (name: string) => set({ name }), // âŒ ç¦æ­¢è¿™æ ·åš
  }))
);
```

**åŸå› **ï¼š

- æ··åˆäº†çŠ¶æ€å®šä¹‰å’Œä¸šåŠ¡é€»è¾‘ã€‚
- éš¾ä»¥åœ¨ç±»æ–¹æ³•ä¸­å¤ç”¨é€»è¾‘ã€‚
- è¿èƒŒäº† Manager/ViewController ä½œä¸ºé€»è¾‘ä¸­å¿ƒçš„åŸåˆ™ã€‚

**æ­£ç¡®åšæ³•**ï¼š

- Store åªå®šä¹‰çŠ¶æ€ã€‚
- ä½¿ç”¨ `setState` æ–¹æ³•æ›´æ–°çŠ¶æ€ã€‚
- ä¸šåŠ¡é€»è¾‘å®šä¹‰ä¸ºç±»çš„æˆå‘˜æ–¹æ³•ã€‚

```typescript
// âœ… æ­£ç¡®ç¤ºèŒƒ
class MyManager {
  private readonly store = createStore(
    immer(combine(initialState, () => ({}))) // âœ… ç©ºçš„ actions å¯¹è±¡
  );

  updateName(name: string) {
    this.setState((state) => {
      state.name = name;
    }); // âœ… ä½¿ç”¨ setState
  }
}
```

### âŒ åˆ›å»ºç‹¬ç«‹çš„ Store ç›®å½•

**åæ¨¡å¼**ï¼šåœ¨ Feature ç›®å½•ä¸‹åˆ›å»º `store/` ç›®å½•ï¼Œå¹¶åœ¨å…¶ä¸­å®šä¹‰å…¨å±€æˆ–æ¨¡å—çº§çš„ Storeã€‚

**åŸå› **ï¼š

- ç ´åäº† Manager/ViewController çš„å°è£…æ€§ã€‚
- å¯¼è‡´çŠ¶æ€ç®¡ç†é€»è¾‘ä¸ä¸šåŠ¡é€»è¾‘åˆ†ç¦»ã€‚
- å®¹æ˜“é€€åŒ–ä¸ºå…¨å±€å˜é‡æ»¥ç”¨ã€‚

**æ­£ç¡®åšæ³•**ï¼š

- çŠ¶æ€æ˜¯ Manager æˆ– ViewController çš„**ç§æœ‰å®ç°ç»†èŠ‚**ã€‚
- ä½¿ç”¨ `import { createStore } from 'zustand/vanilla';` åœ¨ç±»å†…éƒ¨åˆ›å»º Storeã€‚
- å¤–éƒ¨åªèƒ½é€šè¿‡ Manager/ViewController çš„æ–¹æ³•æˆ–å±æ€§è®¿é—®çŠ¶æ€ã€‚

### âŒ ä¾èµ– useCombinedStore Selector å‚æ•°

**åæ¨¡å¼**ï¼šåœ¨ `useCombinedStore` çš„ selector å›è°ƒä¸­ä½¿ç”¨å‚æ•°æ¥è·å– Stateã€‚

```typescript
// âŒ é”™è¯¯ç¤ºèŒƒ
const sections = useCombinedStore(
  vc.combinedStore,
  (detailState, sectionState) => sectionState // âŒ ä¾èµ– Store é¡ºåº
);
```

**åŸå› **ï¼š

- å¯¼è‡´ä»£ç å¯¹ `combinedStore` ä¸­ Store çš„é¡ºåºäº§ç”Ÿéšå¼ä¾èµ–ï¼Œä¸€æ—¦é¡ºåºè°ƒæ•´å®¹æ˜“å¼•å‘ Bugã€‚
- é™ä½äº†ä»£ç çš„å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚

**æ­£ç¡®åšæ³•**ï¼š

- Selector å›è°ƒä¿æŒç©ºå‚æ•°ã€‚
- ç›´æ¥é€šè¿‡ Manager æˆ–è€… VC çš„å±æ€§è®¿é—®çŠ¶æ€ã€‚

```typescript
// âœ… æ­£ç¡®ç¤ºèŒƒ
const sections = useCombinedStore(
  vc.combinedStore,
  () => vc.sectionSizeManager.state // âœ… ç›´æ¥è®¿é—® Manager å±æ€§
);
```

## 4. æ€»ç»“

- **ä¿æŒç»„ä»¶çº¯å‡€**ï¼šç»„ä»¶åªè´Ÿè´£ UIã€‚
- **é€»è¾‘ä¸‹æ²‰**ï¼šå¤æ‚é€»è¾‘å» Managerã€‚
- **é€‚åº¦ä¼˜åŒ–**ï¼šä¸è¦è¿‡æ—©ä¼˜åŒ–ï¼ˆPremature Optimizationï¼‰ã€‚
