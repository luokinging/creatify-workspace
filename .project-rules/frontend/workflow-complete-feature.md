---
description: Complete Feature 工作流程 - 全新功能模块开发的标准流程，包含 Spec 编写和分阶段实现
---

# 工作流程：Complete Feature（完整功能开发）

**原则：Spec 优先，架构先行，质量保障。**

---

## 步骤 1：Spec 编写（规格说明编写）

**这是最重要的步骤，必须先完成 Spec 才能开始编码。**

### 1.1 需求分析
- 理解功能需求，明确用户场景
- 列出功能清单和用例
- 确定核心功能和次要功能
- 识别边界情况和异常处理

### 1.2 代码调研
- 搜索类似功能的实现，理解现有模式
- 查找可复用的组件和工具函数
- **重要：** 如果识别到可复用的组件/函数等，优先抽取出复用部分，单独作为一个组件或工具函数
- 理解项目的架构模式和目录组织方式
- 查看现有 Manager 和 ViewController 的实现方式

### 1.3 架构设计 Spec

**必须详细设计以下内容：**

**1.3.1 模块划分**
- 列出所有需要的 Manager 及其职责
- 列出所有需要的 Service 依赖
- 描述 Manager 之间的依赖关系
- 描述 ViewController 和 Manager 的关系

**1.3.2 数据建模**
- 列出所有核心实体和数据结构
- 描述数据流：数据来源 -> 转换 -> 存储 -> 使用
- 列出所有需要的类型定义（Type/Interface）
- 描述状态管理方案（哪些用 Zustand Store，哪些用 CombinedStore）
- **工具复用：优先使用 `PaginatedQueryManager`、`createAutoKeyMiniQueryClient` 等工具类管理数据获取，参考 `.project-rules/frontend/utility-managers.md`**

**1.3.3 接口定义**
- 定义所有 Manager 的接口（Interface）
- 明确每个方法的输入输出类型
- 定义所有 API 函数的签名
- 定义所有组件的 Props 类型

**1.3.4 目录结构设计**
- 列出所有需要创建的文件和目录
- 列出所有需要修改的文件
- 遵循项目的目录结构标准
- 明确每个文件的职责
- **重要：** 不需要创建统一的 `index.ts` 或 `index.tsx` 导出文件（如 `feature/example/index.ts`），直接使用具体文件的导入路径。注意：`page/` 目录下的 `index.tsx` 是页面入口文件，不是统一导出文件，这是允许的。

**1.3.5 组件设计**
- 列出所有需要的 UI 组件（component/）
- 列出所有需要的 Block 组件（block/）
- 描述组件的层级关系和组合方式
- 明确组件的复用性
- **重要：** 如果识别到可复用的组件/函数等，优先抽取出复用部分，单独作为一个组件

**1.3.6 数据流设计**
- 描述用户交互触发的事件流
- 描述数据获取和更新的流程
- 描述错误处理和 Loading 状态的处理
- 描述状态更新的时机和方式

**输出物：**
- 完整的 Spec 文档，包含以上所有内容
- 文件清单：列出所有需要创建和修改的文件
- 类型定义清单：列出所有需要定义的类型
- 接口定义清单：列出所有需要定义的接口

---

## 步骤 2：Spec 评审与确认

**在开始编码前，必须确认：**
- [ ] Spec 是否完整？是否覆盖了所有功能点？
- [ ] 架构设计是否合理？是否符合项目规范？
- [ ] 目录结构是否正确？是否符合项目标准？
- [ ] 类型定义是否完整？是否考虑了所有边界情况？
- [ ] 是否有遗漏的依赖关系？

**只有 Spec 确认无误后，才能进入编码阶段。**

---

## 步骤 3：搭建骨架

**严格按照 Spec 中的目录结构设计创建文件：**

1. **创建目录结构**
   - 按照 Spec 中的目录结构创建所有目录
   - 确保目录命名符合项目规范

2. **创建类型定义文件**
   - 在 `type.ts` 中定义所有类型
   - 确保类型定义完整且正确

3. **创建接口定义文件**
   - 在 `manager/interface/` 中定义所有 Manager 接口
   - 确保接口定义完整且符合项目规范

4. **创建 Manager 骨架**
   - 创建所有 Manager 文件，只包含 `bootstrap` 和 `dispose` 方法
   - 确保构造函数和依赖注入正确

5. **创建组件骨架**
   - 创建所有组件文件，只包含基本的组件结构
   - 确保 Props 类型定义正确

**验证骨架：**
- 运行类型检查确保所有类型定义正确
- 确保目录结构符合项目标准
- 确保所有文件都能正确导入导出
- **重要：** 不要创建统一的 `index.ts` 或 `index.tsx` 导出文件，直接使用具体文件的导入路径

---

## 步骤 4：分阶段实现

**严格按照 Spec 中的设计逐步实现：**

### 阶段 1：数据层实现
- 实现所有 API 调用函数（在 `api/` 目录）
- **工具复用：数据获取优先使用 `PaginatedQueryManager`、`createAutoKeyMiniQueryClient` 等工具类**
- 实现 Manager 的数据获取逻辑
- 实现状态管理（Zustand Store 或 CombinedStore）
- 运行类型检查确保数据层正确

### 阶段 2：业务逻辑层实现
- 实现 Manager 的所有业务方法
- 实现 ViewController 的交互逻辑
- 实现错误处理和边界情况处理
- 运行类型检查确保业务逻辑正确

### 阶段 3：视图层实现
- 实现基础 UI 组件（在 `component/` 目录）
- 实现 Block 组件（在 `block/` 目录）
- **重要：** 如果识别到可复用的组件/函数等，优先抽取出复用部分，单独作为一个组件
- 组装 Page 组件
- 运行类型检查和 lint 检查

### 阶段 4：交互与优化
- 实现用户交互逻辑
- 添加 Loading/Error 状态处理
- 优化代码结构和性能
- 最终验证所有检查通过

---

## 步骤 5：增量验证

**每个阶段完成后：**
1. 运行类型检查
2. 运行代码格式检查
3. 运行代码质量检查
4. 读取并修复所有错误
5. 对照 Spec 检查实现是否完整

---

## 步骤 6：最终验证

- [ ] 对照 Spec 检查所有功能是否实现
- [ ] 所有类型检查通过
- [ ] 所有 lint 检查通过
- [ ] 代码遵循项目架构规范
- [ ] 所有 Manager 都实现了 `bootstrap` 和 `dispose`
- [ ] 依赖注入正确（通过构造函数传入依赖，在 `new` 的时候传递实例）
- [ ] 没有"上帝组件"（组件职责单一）
- [ ] 代码可读性和可维护性良好
- [ ] 没有未使用的导入和代码

