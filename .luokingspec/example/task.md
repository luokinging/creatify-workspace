# T-001 创建项目详情页面路由和占位页面

## 需求描述

**Infrastructure：创建路由和占位页面**

为项目详情功能创建路由配置和占位页面组件，建立后续功能开发的基础框架。

**需求类型**：Infrastructure

**涉及领域**：前端

### 1. 路由配置

使用 TanStack Router 配置路由，路径为 `/projects/:id`，其中 `:id` 为 UUID 格式的项目 ID。

**路由参数校验规则**：
- 项目 ID 必须是有效的 UUID v4 格式（如 `123e4567-e89b-12d3-a456-426614174000`）
- 无效格式的 ID 应在路由层面被拒绝，重定向到 404 页面

### 2. 占位页面布局

创建占位页面组件，采用以下布局结构：

```
┌─────────────────────────────────────────────────────────────┐
│  [← 返回列表]                                    页面标题区域  │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│                    页面内容区域（居中）                        │
│                                                             │
│              ┌─────────────────────────┐                    │
│              │   🏗️ 页面建设中...       │                    │
│              │   项目 ID: {projectId}   │                    │
│              └─────────────────────────┘                    │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

**布局要求**：
- 页面宽度：最大 1200px，居中显示
- 顶部导航区域：高度 64px，包含返回按钮和页面标题
- 内容区域：垂直居中显示占位信息
- 整体样式与现有页面（如项目列表页）保持一致

### 3. 组件结构

```
project-detail/
├── route.tsx                    # 路由配置文件
├── page/
│   └── ProjectDetailPage.tsx    # 页面入口组件
└── component/
    └── PagePlaceholder.tsx      # 占位内容组件
```

## 相关指引

**前端规则:**
- `.project-rules/frontend/architecture.md` - 了解路由配置和页面组件结构
- `.project-rules/frontend/directory-structure.md` - 了解功能目录组织规范

**前端Code Point:**
- `webserver/frontend/router/` - 路由配置文件位置
- `webserver/frontend/feature/project-detail/` - 项目详情页面代码位置（待创建）

**前端路由:**
- `/projects/:id` - 项目详情路由

## 注意点

- 路由参数需要正确配置，支持项目 ID（UUID 格式）
- 占位页面应该包含基础的布局结构，与现有页面保持一致
- 需要考虑路由验证和错误处理（如项目不存在的情况）

## Scenario

### Scenario 1: 用户通过 URL 访问项目详情页面

    **场景描述：**
    - **前置条件**：用户已登录，知道项目的 ID
    - **操作步骤**：
      1. 用户在浏览器地址栏输入 `/projects/123e4567-e89b-12d3-a456-426614174000`
      2. 系统解析路由参数，提取项目 ID
      3. 渲染项目详情占位页面
    - **预期结果**：
      - 页面成功加载，显示基础布局
      - URL 中的项目 ID 被正确解析
      - 页面显示占位内容（如"项目详情页面"）

## Checklist

- [ ] C-001 路由配置正确，可以通过 URL 访问项目详情页面
- [ ] C-002 占位页面组件创建完成，包含基础布局结构
- [ ] C-003 页面可以正确接收和解析路由参数（项目 ID）
- [ ] C-004 路由验证正确，无效的项目 ID 格式会被拒绝
- [ ] C-005 页面布局与现有页面风格保持一致

---

# T-002 实现项目详情页面跳转功能 (deps: T-001)

## 需求描述

**Feature：实现页面跳转**

在项目列表页面添加跳转到项目详情页面的功能，支持多种触发方式和完整的浏览器历史记录支持。

**需求类型**：Feature

**涉及领域**：前端

### 1. 跳转触发方式

在项目列表的每个项目卡片/行上支持以下跳转方式：

| 触发方式 | 行为 | 备注 |
|---------|------|------|
| 点击项目卡片 | 跳转到项目详情页 | 整个卡片区域可点击 |
| 点击"查看详情"按钮 | 跳转到项目详情页 | 按钮位于卡片右下角 |
| 右键菜单 → "在新标签页打开" | 新标签页打开详情页 | 可选功能 |

### 2. 项目卡片 UI 更新

```
┌──────────────────────────────────────────────────────────┐
│  项目卡片（可点击区域）                                     │
│ ┌─────────────────────────────────────────────────────┐ │
│ │  📁 项目名称                           [状态标签]     │ │
│ │  项目描述文本，最多显示两行，超出部分...               │ │
│ │                                                     │ │
│ │  创建时间: 2024-01-15        [查看详情 →] ← 按钮     │ │
│ └─────────────────────────────────────────────────────┘ │
└──────────────────────────────────────────────────────────┘
         ↑ 鼠标悬停时显示 hover 效果（背景色变化 + cursor: pointer）
```

**交互细节**：
- 鼠标悬停时：卡片背景色变为 `bg-gray-50`，显示阴影效果
- "查看详情"按钮：悬停时显示下划线，颜色变为主题色
- 点击时：按钮显示 loading 状态（可选，用于慢网络情况）

### 3. 导航实现

使用 TanStack Router 的 `useNavigate` hook 进行编程式导航：

```typescript
// 示例代码
const navigate = useNavigate();
navigate({ to: '/projects/$id', params: { id: project.id } });
```

**导航要求**：
- 使用 `push` 模式，保留浏览器历史记录
- 跳转前不需要预加载数据（由目标页面负责）
- 支持 `Ctrl/Cmd + Click` 在新标签页打开

### 4. 状态保持

当用户从详情页返回列表页时：
- 列表页的滚动位置应被恢复（通过 TanStack Router 的 scroll restoration 功能）
- 之前的筛选条件和搜索关键词应保持不变（依赖路由状态或 URL 参数）

## 相关指引

**前端规则:**
- `.project-rules/frontend/architecture.md` - 了解页面导航和路由跳转规范

**前端Code Point:**
- `webserver/frontend/feature/project-list/` - 项目列表页面代码
- `webserver/frontend/feature/project-detail/` - 项目详情页面代码

**前端路由:**
- `/projects` - 项目列表路由
- `/projects/:id` - 项目详情路由

## 注意点

- 跳转时需要使用正确的导航方法，避免页面刷新
- 需要考虑项目列表页面的加载状态，避免在数据未加载完成时跳转
- 跳转后需要保持项目列表的滚动位置（如果用户返回）

## Scenario

### Scenario 1: 用户从项目列表跳转到项目详情

    **场景描述：**
    - **前置条件**：用户在项目列表页面，已加载项目列表数据
    - **操作步骤**：
      1. 用户点击某个项目的"查看详情"按钮
      2. 系统获取该项目的 ID
      3. 使用路由导航跳转到 `/projects/{projectId}`
    - **预期结果**：
      - 页面平滑跳转到项目详情页面
      - URL 正确更新为 `/projects/{projectId}`
      - 浏览器历史记录正确更新，支持后退操作

### Scenario 2: 用户使用浏览器后退按钮返回列表

    **场景描述：**
    - **前置条件**：用户已从项目列表跳转到项目详情页面
    - **操作步骤**：
      1. 用户点击浏览器的后退按钮
    - **预期结果**：
      - 页面返回到项目列表
      - 项目列表的滚动位置和筛选状态得到保持（如果可能）

## Checklist

- [ ] C-001 项目列表页面可以点击跳转到项目详情页面
- [ ] C-002 跳转时正确传递项目 ID
- [ ] C-003 浏览器前进后退功能正常工作
- [ ] C-004 跳转过程中显示适当的加载状态
- [ ] C-005 无效的项目 ID 跳转会显示错误提示

---

# T-003 实现项目基本信息展示功能 (deps: T-001, T-002)

## 需求描述

**Feature：项目基本信息展示**

在项目详情页面展示完整的项目基本信息，包括数据获取、UI 展示和各种状态处理。

**需求类型**：Feature

**涉及领域**：全栈

### 1. 页面整体布局

```
┌─────────────────────────────────────────────────────────────────┐
│  顶部导航栏                                                      │
│  [← 返回项目列表]                              [编辑] [删除]      │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │  项目信息卡片                                             │   │
│  │                                                          │   │
│  │  项目名称                               [状态标签]         │   │
│  │  ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━      │   │
│  │                                                          │   │
│  │  项目描述                                                 │   │
│  │  这里是项目的详细描述内容，可以是多行文本...                │   │
│  │                                                          │   │
│  │  ┌──────────────┬──────────────┬──────────────┐          │   │
│  │  │  📅 创建时间  │  📅 更新时间  │  👤 创建者    │          │   │
│  │  │  2024-01-15  │  2024-01-20  │  张三         │          │   │
│  │  └──────────────┴──────────────┴──────────────┘          │   │
│  │                                                          │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### 2. 各字段展示规范

| 字段 | 位置 | 样式 | 格式化规则 |
|-----|------|------|----------|
| 项目名称 | 卡片顶部左侧 | `text-2xl font-bold text-gray-900` | 原样显示，最长 100 字符 |
| 状态标签 | 卡片顶部右侧 | 圆角标签，不同状态不同颜色 | 见下方状态颜色表 |
| 项目描述 | 名称下方 | `text-base text-gray-600 leading-relaxed` | 支持多行，无字符限制 |
| 创建时间 | 底部信息区左 | `text-sm text-gray-500` | `YYYY-MM-DD HH:mm` 格式 |
| 更新时间 | 底部信息区中 | `text-sm text-gray-500` | `YYYY-MM-DD HH:mm` 格式 |
| 创建者 | 底部信息区右 | `text-sm text-gray-500` | 显示用户名称 |

**状态标签颜色映射**：

| 状态值 | 显示文本 | 背景色 | 文字色 |
|-------|---------|-------|-------|
| `draft` | 草稿 | `bg-gray-100` | `text-gray-600` |
| `active` | 进行中 | `bg-blue-100` | `text-blue-700` |
| `completed` | 已完成 | `bg-green-100` | `text-green-700` |
| `archived` | 已归档 | `bg-yellow-100` | `text-yellow-700` |

### 3. 数据加载状态处理

**状态定义**：

```typescript
type LoadingState = 
  | { status: 'idle' }           // 初始状态
  | { status: 'loading' }        // 加载中
  | { status: 'success'; data: Project }  // 加载成功
  | { status: 'error'; error: ErrorType } // 加载失败
```

#### 3.1 Loading 状态 UI

当 `status === 'loading'` 时，显示骨架屏（Skeleton）而非 loading spinner：

```
┌─────────────────────────────────────────────────────────────┐
│  项目信息卡片 (骨架屏)                                        │
│                                                             │
│  ████████████████████████              [██████]             │
│  ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━       │
│                                                             │
│  ████████████████████████████████████████████               │
│  ████████████████████████████████                           │
│                                                             │
│  ┌──────────────┬──────────────┬──────────────┐             │
│  │  ████████    │  ████████    │  ████████    │             │
│  └──────────────┴──────────────┴──────────────┘             │
└─────────────────────────────────────────────────────────────┘
```

**骨架屏要求**：
- 使用 `animate-pulse` 动画效果
- 骨架块颜色：`bg-gray-200`
- 布局结构与实际内容保持一致

#### 3.2 Error 状态处理

根据错误类型显示不同的 UI：

**a) 项目不存在 (404)**

```
┌─────────────────────────────────────────────────────────────┐
│                                                             │
│                      📭 项目不存在                            │
│                                                             │
│           该项目可能已被删除或您输入的链接有误                   │
│                                                             │
│                    [返回项目列表]                             │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

**b) 权限不足 (403)**

```
┌─────────────────────────────────────────────────────────────┐
│                                                             │
│                      🔒 无访问权限                            │
│                                                             │
│              您没有权限查看此项目，请联系项目管理员               │
│                                                             │
│                    [返回项目列表]                             │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

**c) 网络错误 / 服务器错误 (5xx / NetworkError)**

```
┌─────────────────────────────────────────────────────────────┐
│                                                             │
│                      ⚠️ 加载失败                             │
│                                                             │
│             网络连接异常，请检查网络后重试                      │
│                                                             │
│                [重试] ← 主按钮    [返回列表] ← 次按钮          │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

**重试机制**：
- 点击"重试"按钮后，按钮显示 loading 状态
- 重试时重新调用 API 获取数据
- 最多允许手动重试 3 次，之后隐藏重试按钮

## 相关指引

**前端规则:**
- `.project-rules/frontend/architecture.md` - 了解 Manager 模式和数据获取规范
- `.project-rules/frontend/utility-managers.md` - 了解工具管理器使用方式

**后端规则:**
- `.project-rules/backend/index.md` - 了解 API 设计规范

**前端Code Point:**
- `webserver/frontend/feature/project-detail/manager/project-detail-view-controller.tsx` - 视图控制器
- `webserver/frontend/feature/project-detail/api/project.api.ts` - API 客户端

**后端Code Point:**
- `webserver/backend/api/projects.py` - 项目详情 API 端点
- `webserver/backend/models/project.py` - 项目数据模型

**其他:**
- 设计稿链接：`/project-detail-basic-info.png`

## 注意点

- 需要处理数据加载状态和失败情况
- API 调用需要考虑错误处理和重试机制
- 项目不存在时（404）需要显示友好的错误提示
- 需要考虑权限控制（用户是否有权限查看该项目）
- 数据格式需要与后端 API 响应格式保持一致

## Scenario

### Scenario 1: 用户查看项目基本信息

    **场景描述：**
    - **前置条件**：用户已跳转到项目详情页面，项目 ID 有效
    - **操作步骤**：
      1. 页面加载时自动调用 API 获取项目详情
      2. 显示加载状态（loading spinner）
      3. API 返回成功后，展示项目基本信息
    - **预期结果**：
      - 加载过程中显示加载状态
      - 数据加载成功后，正确展示项目名称、描述、创建时间等信息
      - 信息展示格式美观，符合设计规范

### Scenario 2: 项目不存在的情况

    **场景描述：**
    - **前置条件**：用户访问一个不存在的项目 ID
    - **操作步骤**：
      1. 页面加载时调用 API
      2. API 返回 404 错误
    - **预期结果**：
      - 显示友好的错误提示："项目不存在或已被删除"
      - 提供返回项目列表的链接
      - 不显示技术错误信息

### Scenario 3: API 调用失败的情况

    **场景描述：**
    - **前置条件**：网络错误或服务器错误
    - **操作步骤**：
      1. 页面加载时调用 API
      2. API 调用失败（网络错误或 500 错误）
    - **预期结果**：
      - 显示错误提示："加载项目信息失败，请稍后重试"
      - 提供重试按钮
      - 记录错误日志便于排查

## Checklist

- [ ] C-001 页面可以正确获取项目基本信息
- [ ] C-002 项目基本信息正确展示（名称、描述、创建时间、状态等）
- [ ] C-003 数据加载时显示 loading 状态
- [ ] C-004 数据加载失败时显示错误提示
- [ ] C-005 项目不存在时（404）显示友好的错误提示
- [ ] C-006 权限不足时显示相应的错误提示
- [ ] C-007 API 调用使用正确的认证 token
- [ ] C-008 数据格式与后端 API 响应格式一致
